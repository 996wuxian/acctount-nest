{"openapi":"3.0.0","paths":{"/":{"get":{"operationId":"AppController_getHello","parameters":[],"responses":{"200":{"description":""}},"tags":["App"]}},"/user/apk":{"get":{"description":"读取 package/release.json，比对 ?version；一致返回“已是最新”，并给出日期与更新内容；不一致返回下载 URL、最新版本、日期与更新内容；携带 ?download=1 直接下载最新版。","operationId":"UserController_apk","parameters":[{"name":"download","required":false,"in":"query","description":"为 1 时直接下载","schema":{"type":"string"}},{"name":"version","required":false,"in":"query","description":"客户端当前版本","schema":{"type":"string"}}],"responses":{"200":{"description":"返回下载地址或直接下载文件","content":{"application/json":{"schema":{"type":"object","properties":{"isLatest":{"type":"boolean","example":false},"latestVersion":{"type":"string","example":"2.8.0"},"date":{"type":"string","example":"2025-10-21"},"content":{"type":"array","items":{"type":"string"}},"url":{"type":"string","example":"http://localhost:3000/user/apk?download=1"},"message":{"type":"string","example":"已经是最新版本"}}}}}}},"summary":"APK 下载/地址（含版本判断）","tags":["User"]}},"/user/register":{"post":{"description":"传昵称和密码，返回分配的账号","operationId":"UserController_register","parameters":[],"requestBody":{"required":true,"description":"注册请求体","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateUserDto"}}}},"responses":{"200":{"description":"注册成功","content":{"application/json":{"schema":{"type":"object","properties":{"account":{"type":"integer","example":10000000}}}}}}},"summary":"注册用户","tags":["User"]}},"/user/login":{"post":{"description":"使用账号与密码登录，返回永不过期 token 和用户信息（不含密码）","operationId":"UserController_login","parameters":[],"requestBody":{"required":true,"description":"登录请求体","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginUserDto"}}}},"responses":{"200":{"description":"登录成功","content":{"application/json":{"schema":{"type":"object","properties":{"token":{"type":"string","example":"eyJhbGciOi..."},"id":{"type":"integer","example":1},"account":{"type":"integer","example":10000000},"nickname":{"type":"string","example":"张三"},"avatar":{"type":"string","nullable":true,"example":"https://example.com/avatar.png"},"isVip":{"type":"boolean","example":false},"registerTime":{"type":"string","format":"date-time","example":"2025-10-17T08:00:00.000Z"}}}}}}},"summary":"登录","tags":["User"]}},"/user":{"post":{"operationId":"UserController_create","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateUserDto"}}}},"responses":{"200":{"description":"创建成功"}},"summary":"创建用户（同注册）","tags":["User"]},"get":{"operationId":"UserController_findAll","parameters":[],"responses":{"200":{"description":"返回用户列表"}},"summary":"获取所有用户","tags":["User"]}},"/user/{id}":{"get":{"operationId":"UserController_findOne","parameters":[{"name":"id","required":true,"in":"path","description":"用户ID","schema":{"example":1,"type":"string"}}],"responses":{"200":{"description":"返回用户详情"}},"summary":"获取指定用户","tags":["User"]},"patch":{"operationId":"UserController_update","parameters":[{"name":"id","required":true,"in":"path","description":"用户ID","schema":{"example":1,"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateUserDto"}}}},"responses":{"200":{"description":"更新成功"}},"summary":"更新指定用户","tags":["User"]},"delete":{"operationId":"UserController_remove","parameters":[{"name":"id","required":true,"in":"path","description":"用户ID","schema":{"example":1,"type":"string"}}],"responses":{"200":{"description":"删除成功"}},"summary":"删除指定用户","tags":["User"]}},"/user/apk/download":{"get":{"description":"直接返回最新版 APK 文件进行下载（基于 release.json）","operationId":"UserController_downloadApk","parameters":[],"responses":{"200":{"description":"APK 二进制文件","content":{"application/octet-stream":{"schema":{"type":"string","format":"binary"}}}}},"summary":"下载 APK","tags":["User"]}},"/review/{parentId}/reply":{"post":{"description":"仅允许回复根评价（不可对回复再回复），只需消息内容","operationId":"ReviewController_reply","parameters":[{"name":"parentId","required":true,"in":"path","description":"父评价ID（必须为根评价）","schema":{"example":10,"type":"number"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ReplyReviewDto"}}}},"responses":{"200":{"description":"回复成功，返回回复对象"}},"security":[{"bearer":[]}],"summary":"回复评价（仅一级）","tags":["Review"]}},"/review":{"post":{"description":"无需消息ID，系统会将该评价的 id 作为 messageId","operationId":"ReviewController_create","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateReviewDto"}}}},"responses":{"200":{"description":"创建成功，返回评价对象"}},"security":[{"bearer":[]}],"summary":"创建评价（根评价）","tags":["Review"]}},"/review/messages":{"get":{"description":"返回所有根评价及其直接回复","operationId":"ReviewController_findAllMessages","parameters":[],"responses":{"200":{"description":"查询成功"}},"security":[{"bearer":[]}],"summary":"获取全部消息（根评价线程）","tags":["Review"]}},"/review/message/{messageId}":{"get":{"description":"返回该消息的所有根评价及其直接回复","operationId":"ReviewController_findByMessage","parameters":[{"name":"messageId","required":true,"in":"path","description":"消息ID","schema":{"example":1001,"type":"number"}}],"responses":{"200":{"description":"查询成功"}},"security":[{"bearer":[]}],"summary":"按消息查询评价列表","tags":["Review"]},"delete":{"description":"按 messageId 删除根评价及其直接回复","operationId":"ReviewController_deleteMessage","parameters":[{"name":"messageId","required":true,"in":"path","description":"消息ID（根评价的 id）","schema":{"example":1001,"type":"number"}}],"responses":{"200":{"description":"删除成功"}},"security":[{"bearer":[]}],"summary":"删除消息（整条评价线程）","tags":["Review"]}},"/review/{id}":{"get":{"description":"包含该评价的直接回复","operationId":"ReviewController_findOne","parameters":[{"name":"id","required":true,"in":"path","description":"评价ID","schema":{"example":1,"type":"number"}}],"responses":{"200":{"description":"查询成功"}},"security":[{"bearer":[]}],"summary":"评价详情","tags":["Review"]}}},"info":{"title":"template-nest","description":"","version":"1.0","contact":{}},"tags":[],"servers":[],"components":{"schemas":{"CreateUserDto":{"type":"object","properties":{"nickname":{"type":"string","description":"昵称","minLength":2,"maxLength":64,"example":"张三"},"password":{"type":"string","description":"密码","minLength":6,"maxLength":128,"example":"secret123"}},"required":["nickname","password"]},"LoginUserDto":{"type":"object","properties":{"account":{"type":"number","description":"账号（从 10000000 起）","minimum":10000000,"example":10000000},"password":{"type":"string","description":"密码","minLength":6,"maxLength":128,"example":"secret123"}},"required":["account","password"]},"UpdateUserDto":{"type":"object","properties":{}},"ReplyReviewDto":{"type":"object","properties":{"content":{"type":"string","description":"回复内容","example":"同意你的看法","minLength":1,"maxLength":1000}},"required":["content"]},"CreateReviewDto":{"type":"object","properties":{"rating":{"type":"number","description":"评分(1-5)","example":5,"minimum":1,"maximum":5},"content":{"type":"string","description":"评价内容","example":"非常不错！","minLength":1,"maxLength":1000}},"required":["rating","content"]}}},"externalDocs":{"description":"api-json","url":"http://localhost:3000/api-json"}}